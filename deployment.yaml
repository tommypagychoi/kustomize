apiVersion: apps/v1
kind: Deployment
metadata:
  name: test
spec:
  template:
    spec:
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: topology.kubernetes.io/zone
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app: overlay
      containers:
      - name: main
        image: image
        imagePullPolicy: Always
        ports:
        - containerPort: 35080
          #        readinessProbe:
          #          httpGet:
          #            path: /emm/admin/login.do
          #            port: 35080
          #          initialDelaySeconds: 30
          #          periodSeconds: 30
          #          successThreshold: 2
          #        livenessProbe:
          #          httpGet:
          #            path: /emm/admin/login.do
          #            port: 35080
          #          initialDelaySeconds: 30
          #          periodSeconds: 30
        command: ["/bin/sh","-c"]
        args: ["/data/apache-tomcat/bin/catalina.sh run"]
        envFrom:
        - configMapRef:
            name: cm #overlay
        - secretRef:
            name: db-secret #overlay
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: LOG_PATH
          value: /data/logs/app/$(SERVICE)/$(POD_NAME)
        #  #value: /data/logs/app/$(SERVICE)/$(NODE_NAME)
        - name: FILE_STORAGE_PATH
          value: /data/storage/$(SERVICE)/storage
          #        volumeMounts:
          #        - name : log-pv
          #          mountPath: /data/logs
          #        - name : storage-pv
          #          mountPath: /data/storage
          #      volumes:
          #      - name: log-pv
          #        persistentVolumeClaim:
          #          claimName: efs-log #dev
          #      - name: storage-pv
          #        persistentVolumeClaim:
          #          claimName: efs-storage #dev
